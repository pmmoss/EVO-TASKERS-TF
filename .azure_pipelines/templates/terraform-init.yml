parameters:
  - name: environment
    type: string
  - name: workingDirectory
    type: string
  - name: AzureRM-Connection
    type: string
    default: 'AzureRM-Connection'
steps:
  - task:AzureCLI@2
    inputs:
      azureSubscription: ${parameters.AzureRM-Connection}  # <-- Use your actual service connection name
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: 
        terraform init \
        -backend-config="resource_group_name=$(BACKEND_RESOURCE_GROUP_NAME)" \
        -backend-config="storage_account_name=$(BACKEND_STORAGE_ACCOUNT_NAME)" \
        -backend-config="container_name=$(BACKEND_CONTAINER_NAME)" \
        -backend-config="subscription_id=$(BACKEND_SUBSCRIPTION_ID)" \
        -backend-config="tenant_id=$(BACKEND_TENANT_ID)" \
        -backend-config="key=${{ parameters.environment }}.tfstate"
    workingDirectory: ${{ parameters.workingDirectory }}
    displayName: 'Terraform Init'
