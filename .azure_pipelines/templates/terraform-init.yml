parameters:
  - name: environment
    type: string
  - name: workingDirectory
    type: string

steps:
  - script: |
      terraform init \
        -backend-config="resource_group_name=$(BACKEND_RESOURCE_GROUP_NAME)" \
        -backend-config="storage_account_name=$(BACKEND_STORAGE_ACCOUNT_NAME)" \
        -backend-config="container_name=$(BACKEND_CONTAINER_NAME)" \
        -backend-config="subscription_id=$(BACKEND_SUBSCRIPTION_ID)" \
        -backend-config="tenant_id=$(BACKEND_TENANT_ID)" \
        -backend-config="key=${{ parameters.environment }}.tfstate"
    workingDirectory: ${{ parameters.workingDirectory }}
    displayName: 'Terraform Init'
