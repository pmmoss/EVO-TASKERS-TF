parameters:
  - name: environment
    type: string
  - name: workingDirectory
    type: string
  - name: AzureRMConnection
    type: string
    default: 'EVO-Taskers-Sandbox'
steps:

  - task: AzureCLI@2
    inputs:
      azureSubscription: ${{parameters.AzureRM-Connection}}  # <-- Use your actual service connection name
      scriptType: 'bash'
      scriptLocation: 'inlineScript'
      inlineScript: 
        terraform workspace select ${{ parameters.environment }} || terraform workspace new ${{ parameters.environment }}
        terraform plan -var-file="${{ parameters.environment }}.tfvars"
    displayName: 'Terraform Plan'
